{
  "META_DOCUMENTATION": {
    "feature_name": "assistant-page-redesign",
    "workorder_id": "WO-ASSISTANT-PAGE-REDESIGN-001",
    "version": "2.0.0",
    "status": "planning",
    "generated_by": "PlanningGenerator",
    "has_context": true,
    "has_analysis": true,
    "plan_revision": "Simplified approach - CodeRef view in Explorer instead of separate Assistant page"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_docs_available": [
        "ARCHITECTURE.md",
        "API.md",
        "COMPONENTS.md",
        "SCHEMA.md",
        "README.md"
      ],
      "context_source": "coderef/workorder/assistant-page-redesign/context.json",
      "analysis_source": "coderef/workorder/assistant-page-redesign/analysis.json",
      "design_change": "Pivoted from separate Assistant page to 'All Projects (CodeRef)' view mode in existing Explorer - 10x simpler, reuses all infrastructure"
    },
    "1_executive_summary": {
      "purpose": "Add CodeRef view mode to Explorer with tab toggle and file type filtering for cross-project CodeRef browsing",
      "value_proposition": "Browse all CLAUDE.md, plan.json, DELIVERABLES.md files across projects in one view - no separate page needed, reuses existing Explorer infrastructure",
      "real_world_analogy": "Like switching your file explorer from 'This PC' (one project) to 'Network' (all projects) - same interface, different scope",
      "use_case": "User manages 5 projects and wants to audit all CLAUDE.md files - clicks 'CodeRef' tab in sidebar controls, clicks CLAUDE.md filter, sees flat list of all CLAUDE.md files with last modified dates, clicks one to read",
      "output": "Tab toggle (Projects/CodeRef) above ProjectSelector, file type filter buttons, aggregated tree view, flat list view with sorting"
    },
    "2_risk_assessment": {
      "overall_risk": "low",
      "complexity": "low (estimate: 3-4 files modified, ~300-400 lines total)",
      "scope": "Small - modify ProjectSelector, add FileTypeFilter component, update FileTree aggregation logic",
      "file_system_risk": "low (read-only, reuses existing /api/coderef/tree)",
      "dependencies": [
        "Existing /api/coderef/projects must return all registered projects",
        "Existing FileTree component must support flat list mode",
        "Project registry must have at least 2 projects for meaningful testing"
      ],
      "performance_concerns": [
        "Aggregating coderef/ folders from 10+ projects will take 3-5 seconds (mitigate with loading skeleton)",
        "Rendering 50+ files in list view will impact scroll performance (mitigate with react-window virtualization if >100 files)"
      ],
      "security_considerations": [
        "Path validation: ensure aggregated paths cannot escape coderef/ boundaries",
        "Project registry validation: only scan projects in ~/.coderef-dashboard/projects.json"
      ],
      "breaking_changes": "none (additive feature, existing project selection unchanged)"
    },
    "3_current_state_analysis": {
      "affected_files": [
        "packages/dashboard/src/components/coderef/ViewModeToggle.tsx (CREATE - Projects/CodeRef tab toggle)",
        "packages/dashboard/src/components/coderef/ProjectSelector.tsx (MODIFY - hide in CodeRef mode)",
        "packages/dashboard/src/components/coderef/FileTypeFilter.tsx (CREATE - filter buttons component)",
        "packages/dashboard/src/widgets/coderef-explorer/CodeRefExplorerWidget.tsx (MODIFY - handle view modes)",
        "packages/dashboard/src/lib/coderef/aggregateCodeRefTrees.ts (CREATE - tree aggregation utility)"
      ],
      "dependencies": {
        "existing_internal": [
          "ProjectSelector - add new dropdown option",
          "FileTree - support flat list mode",
          "FileViewer - works unchanged",
          "/api/coderef/projects - fetch all projects",
          "/api/coderef/tree - scan each project's coderef/ folder"
        ],
        "existing_external": [
          "react - useState for filter selection",
          "lucide-react - icons for filter buttons (FileText, Code, CheckSquare)"
        ],
        "new_external": [],
        "new_internal": []
      },
      "architecture_context": "Explorer page widget-based architecture. Add new view mode to existing ProjectSelector, aggregate trees from multiple projects, render in existing FileTree component with list/tree toggle."
    },
    "4_key_features": {
      "primary_features": [
        "View Mode Toggle - [Projects] [CodeRef] tabs above ProjectSelector to switch between single-project and all-projects modes",
        "Projects Mode - shows ProjectSelector dropdown with individual projects (current behavior)",
        "CodeRef Mode - hides ProjectSelector, shows aggregated coderef/ folders from all projects",
        "File Type Filter buttons - filter by CLAUDE.md, plan.json, DELIVERABLES.md, ARCHITECTURE.md, or All Files (visible only in CodeRef mode)",
        "Tree View mode - hierarchical display grouped by project (default for 'All Files')",
        "List View mode - flat list with metadata (auto-enabled when file type filter selected)"
      ],
      "secondary_features": [
        "Sort options - Last Modified, Project Name, Alphabetical",
        "File count badge - show '(5)' next to filter button if 5 files match",
        "Last modified timestamps - display relative dates (2 days ago, 1 week ago)"
      ],
      "edge_case_handling": [
        "No projects registered: show empty state 'Add projects to see CodeRef files'",
        "No coderef/ folder in project: skip that project silently",
        "Empty coderef/ folder: show 'No CodeRef files found' message",
        "Single project only: still show aggregated view (future-proof for when they add more)"
      ],
      "configuration_options": [
        "None (uses project registry from Explorer)"
      ]
    },
    "5_task_id_system": {
      "tasks": [
        "SETUP-001: Create ViewModeToggle component with [Projects] [CodeRef] tabs",
        "SETUP-002: Add view mode state to CodeRefExplorerWidget (projects vs coderef)",
        "SETUP-003: Create FileTypeFilter component with button group UI",
        "IMPL-001: Create aggregateCodeRefTrees utility to merge coderef/ folders from all projects",
        "IMPL-002: Modify CodeRefExplorerWidget to handle view mode switching",
        "IMPL-003: Hide ProjectSelector in CodeRef mode, show in Projects mode",
        "IMPL-004: Show FileTypeFilter only in CodeRef mode",
        "IMPL-005: Add tree/list view toggle logic based on filter selection",
        "IMPL-006: Implement file type filtering in aggregated tree (pattern matching)",
        "IMPL-007: Add sorting logic (last modified, project name, alphabetical)",
        "IMPL-008: Add file count badges to filter buttons",
        "IMPL-009: Format last modified timestamps with relative dates",
        "TEST-001: Test tab switching between Projects and CodeRef modes",
        "TEST-002: Test with 3 projects, verify all coderef/ folders appear in CodeRef mode",
        "TEST-003: Test file type filters (CLAUDE.md, plan.json, etc.)",
        "TEST-004: Test tree vs list view modes",
        "TEST-005: Test sorting options",
        "TEST-006: Test edge cases (no projects, no coderef/, empty folders)",
        "DOC-001: Add JSDoc to ViewModeToggle and aggregateCodeRefTrees",
        "DOC-002: Update COMPONENTS.md with ViewModeToggle and FileTypeFilter"
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Core Infrastructure",
          "title": "Phase 1: Core Infrastructure",
          "purpose": "Add 'All Projects (CodeRef)' mode and tree aggregation",
          "complexity": "low",
          "effort_level": 2,
          "tasks": [
            "SETUP-001",
            "SETUP-002",
            "IMPL-001",
            "IMPL-002",
            "IMPL-003"
          ],
          "deliverables": [
            "ViewModeToggle component with [Projects] [CodeRef] tabs",
            "View mode state management in CodeRefExplorerWidget",
            "aggregateCodeRefTrees utility functional",
            "ProjectSelector visibility controlled by mode"
          ],
          "completion_criteria": "Clicking 'CodeRef' tab hides ProjectSelector and displays aggregated tree of all coderef/ folders"
        },
        {
          "phase": 2,
          "name": "File Type Filtering",
          "title": "Phase 2: File Type Filtering",
          "purpose": "Add filter buttons and list/tree view modes",
          "complexity": "medium",
          "effort_level": 3,
          "tasks": [
            "SETUP-003",
            "IMPL-004",
            "IMPL-005",
            "IMPL-006"
          ],
          "deliverables": [
            "FileTypeFilter component with button group (visible only in CodeRef mode)",
            "Tree/list view toggle logic",
            "Pattern matching for file type filtering"
          ],
          "completion_criteria": "In CodeRef mode, clicking 'CLAUDE.md' filter shows flat list of only CLAUDE.md files across all projects"
        },
        {
          "phase": 3,
          "name": "Enhancements",
          "title": "Phase 3: Enhancements",
          "purpose": "Add sorting, badges, and timestamps",
          "complexity": "low",
          "effort_level": 2,
          "tasks": [
            "IMPL-007",
            "IMPL-008",
            "IMPL-009",
            "TEST-001",
            "TEST-002",
            "TEST-003",
            "TEST-004",
            "TEST-005",
            "TEST-006",
            "DOC-001",
            "DOC-002"
          ],
          "deliverables": [
            "Sort dropdown (Last Modified, Project Name, Alphabetical)",
            "File count badges on filter buttons",
            "Relative timestamp formatting",
            "All edge cases tested",
            "Documentation updated"
          ],
          "completion_criteria": "Sort works correctly, badges show accurate counts, timestamps display relative dates, all tests pass"
        }
      ]
    },
    "7_testing_strategy": {
      "unit_tests": [
        "Test aggregateCodeRefTrees with 3 projects returning merged tree structure",
        "Test file type pattern matching (*.md, **/plan.json, etc.)",
        "Test relative date formatting (formatRelativeDate: 'Today', 'Yesterday', '2 days ago')",
        "Test sorting functions (sortByLastModified, sortByProjectName, sortAlphabetical)"
      ],
      "integration_tests": [
        "Test ProjectSelector switching to 'All Projects (CodeRef)' triggers aggregation",
        "Test FileTypeFilter selection updates FileTree display mode",
        "Test clicking file in aggregated view opens in FileViewer",
        "Test switching between tree and list views preserves selection"
      ],
      "end_to_end_tests": [
        "User adds 3 projects → selects 'All Projects (CodeRef)' → sees all coderef/ folders",
        "User clicks 'CLAUDE.md' filter → sees flat list → clicks one → FileViewer opens",
        "User sorts by Last Modified → list reorders → most recent at top"
      ],
      "edge_case_scenarios": [
        {
          "scenario": "No projects registered",
          "setup": "Empty projects.json",
          "expected_behavior": "ProjectSelector shows 'All Projects (CodeRef)' option but selecting it shows empty state: 'Add projects to see CodeRef files'",
          "verification": "Verify empty state message renders, no errors in console",
          "error_handling": "No error (valid state)"
        },
        {
          "scenario": "Project has no coderef/ folder",
          "setup": "Add project without coderef/ directory",
          "expected_behavior": "Skip that project silently, show other projects' coderef/ folders",
          "verification": "Aggregated tree shows projects with coderef/, missing project not shown, no errors",
          "error_handling": "Graceful skip (continue with other projects)"
        },
        {
          "scenario": "All projects have empty coderef/ folders",
          "setup": "Create coderef/ directories but no files inside",
          "expected_behavior": "Show 'No CodeRef files found' message",
          "verification": "Empty state renders with helpful message",
          "error_handling": "No error (valid state)"
        },
        {
          "scenario": "Only one project registered",
          "setup": "Single project in registry",
          "expected_behavior": "Aggregated view still works (shows that one project's coderef/)",
          "verification": "Tree renders with single project, no errors, future-proof for adding more projects",
          "error_handling": "No error (valid state)"
        }
      ]
    },
    "8_success_criteria": {
      "functional_requirements": [
        {
          "requirement": "User can view all CLAUDE.md files across projects in <5 seconds",
          "metric": "Time from clicking 'CLAUDE.md' filter to list render",
          "target": "<5000ms with 5 projects",
          "validation": "Browser DevTools Performance: measure filter click → list render complete"
        },
        {
          "requirement": "File type filters show accurate counts",
          "metric": "Badge number matches actual file count",
          "target": "100% accuracy",
          "validation": "Manually count files in filesystem, compare to badge numbers"
        },
        {
          "requirement": "Clicking file opens in FileViewer",
          "metric": "Navigation success rate",
          "target": "100% (all clicks work)",
          "validation": "Click 10 different files from aggregated view, verify all open correctly"
        },
        {
          "requirement": "Sorting reorders list correctly",
          "metric": "Sort order matches selected criteria",
          "target": "100% correct order",
          "validation": "Sort by Last Modified, verify newest at top; sort by Name, verify alphabetical"
        }
      ],
      "quality_requirements": [
        {
          "requirement": "Code reuse",
          "metric": "Percentage of existing components reused",
          "target": ">90% (FileTree, FileViewer, ProjectSelector base)",
          "validation": "Code review: verify FileTree and FileViewer unchanged, only mode logic added"
        },
        {
          "requirement": "TypeScript type coverage",
          "metric": "No 'any' types in new code",
          "target": "100% typed",
          "validation": "Run tsc --noEmit, verify no type errors"
        }
      ],
      "performance_requirements": [
        {
          "requirement": "Aggregation performance",
          "metric": "Time to aggregate 10 projects' coderef/ folders",
          "target": "<3 seconds",
          "validation": "Chrome DevTools: measure API calls + tree merge time"
        },
        {
          "requirement": "List view scroll performance",
          "metric": "Frame rate during scroll with 50 files",
          "target": ">60fps",
          "validation": "Chrome DevTools Performance: record scroll, check FPS counter"
        }
      ],
      "security_requirements": [
        {
          "requirement": "Path boundary validation",
          "metric": "All aggregated paths stay within coderef/ folders",
          "target": "No parent directory traversal",
          "validation": "Code review: verify aggregation only includes coderef/** paths"
        }
      ]
    },
    "9_implementation_checklist": {
      "pre_implementation": [
        "☐ Review simplified plan vs original 41-task plan",
        "☐ Verify at least 2 projects registered for testing",
        "☐ Ensure projects have coderef/ folders with test files"
      ],
      "phase_1": [
        "☐ SETUP-001: Create components/coderef/ViewModeToggle.tsx component",
        "☐ SETUP-001: Add [Projects] [CodeRef] tab buttons with active state styling",
        "☐ SETUP-001: Place ViewModeToggle above ProjectSelector in controls section",
        "☐ SETUP-002: Add viewMode state to CodeRefExplorerWidget ('projects' | 'coderef')",
        "☐ SETUP-002: Connect ViewModeToggle to viewMode state",
        "☐ IMPL-001: Create lib/coderef/aggregateCodeRefTrees.ts utility file",
        "☐ IMPL-001: Implement tree merging logic (fetch all projects, call /api/coderef/tree for each, merge results)",
        "☐ IMPL-001: Add project name prefix to paths (e.g., 'Project Alpha/coderef/workorder/plan.json')",
        "☐ IMPL-002: Add conditional rendering based on viewMode in CodeRefExplorerWidget",
        "☐ IMPL-002: Call aggregateCodeRefTrees when viewMode === 'coderef'",
        "☐ IMPL-002: Pass aggregated tree to FileTree component",
        "☐ IMPL-003: Hide ProjectSelector when viewMode === 'coderef'",
        "☐ IMPL-003: Show ProjectSelector when viewMode === 'projects'",
        "☐ Test: Click 'CodeRef' tab, verify ProjectSelector hides and aggregated tree shows all coderef/ folders"
      ],
      "phase_2": [
        "☐ SETUP-003: Create components/coderef/FileTypeFilter.tsx",
        "☐ SETUP-003: Add button group with options: All Files, CLAUDE.md, plan.json, DELIVERABLES.md, ARCHITECTURE.md",
        "☐ SETUP-003: Style with Tailwind (similar to existing filter components)",
        "☐ IMPL-004: Show FileTypeFilter only when viewMode === 'coderef'",
        "☐ IMPL-004: Place FileTypeFilter below ViewModeToggle in controls section",
        "☐ IMPL-005: Add useState for active filter and display mode (tree/list)",
        "☐ IMPL-005: Auto-switch to list view when specific file type selected",
        "☐ IMPL-005: Switch back to tree view when 'All Files' selected",
        "☐ IMPL-006: Implement pattern matching (e.g., CLAUDE.md → exact match, plan.json → **/plan.json)",
        "☐ IMPL-006: Filter aggregated tree based on active filter",
        "☐ IMPL-006: Flatten tree to list when in list mode",
        "☐ Test: In CodeRef mode, click 'CLAUDE.md' filter, verify only CLAUDE.md files appear in flat list"
      ],
      "phase_3": [
        "☐ IMPL-007: Add sort dropdown with 3 options",
        "☐ IMPL-007: Implement sortByLastModified function (newest first)",
        "☐ IMPL-007: Implement sortByProjectName function (alphabetical by project)",
        "☐ IMPL-007: Implement sortAlphabetical function (by filename)",
        "☐ IMPL-008: Count files for each filter type",
        "☐ IMPL-008: Display badge with count (e.g., 'CLAUDE.md (5)')",
        "☐ IMPL-009: Create formatRelativeDate utility (Today, Yesterday, X days/weeks/months ago)",
        "☐ IMPL-009: Display timestamps in list view",
        "☐ TEST-001: Test tab switching between Projects and CodeRef modes",
        "☐ TEST-001: Verify ProjectSelector visible in Projects mode, hidden in CodeRef mode",
        "☐ TEST-001: Verify FileTypeFilter visible only in CodeRef mode",
        "☐ TEST-002: Test with 3 projects containing various coderef/ structures",
        "☐ TEST-003: Test all file type filters individually",
        "☐ TEST-004: Test tree/list view switching",
        "☐ TEST-005: Test all 3 sort options",
        "☐ TEST-006: Test all 4 edge cases",
        "☐ DOC-001: Add JSDoc to ViewModeToggle and aggregateCodeRefTrees functions",
        "☐ DOC-002: Update COMPONENTS.md with ViewModeToggle and FileTypeFilter entries",
        "☐ Run npm run build:dashboard - verify no TypeScript errors",
        "☐ Manual testing: Click CodeRef tab, test all filters and sort options"
      ],
      "finalization": [
        "☐ All TypeScript errors resolved",
        "☐ All edge cases tested and handled gracefully",
        "☐ Code review: verify follows existing Explorer patterns",
        "☐ Update CLAUDE.md with new feature description",
        "☐ Commit with descriptive message"
      ]
    }
  }
}
