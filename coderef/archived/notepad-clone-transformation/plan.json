{
  "META_DOCUMENTATION": {
    "workorder_id": "WO-NOTEPAD-CLONE-001",
    "feature_name": "notepad-clone-transformation",
    "created_date": "2026-01-08",
    "last_updated": "2026-01-10",
    "status": "pending_implementation",
    "project": "coderef-dashboard",
    "assigned_agent": "Claude (Sonnet 4.5)",
    "document_type": "Implementation Plan",
    "schema_version": "2.0",
    "planning_approach": "Manual creation based on existing context.json and analysis.json"
  },

  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
    "foundation_docs_review": {
      "available_docs": [
        "README.md - Project overview and quick start",
        "ARCHITECTURE.md - System topology and package structure",
        "API.md - REST API endpoints and data models",
        "COMPONENTS.md - React component library",
        "SCHEMA.md - TypeScript interfaces and data models"
      ],
      "missing_docs": [
        "USER-GUIDE.md"
      ],
      "standards_review": {
        "available": [
          "BEHAVIOR-STANDARDS.md - Error handling, loading states",
          "UI-STANDARDS.md - Component patterns, styling",
          "UX-PATTERNS.md - Navigation, permissions",
          "COMPONENT-INDEX.md - Component inventory"
        ],
        "missing": [
          "COMPONENT-PATTERN.md"
        ]
      },
      "reference_components": [
        "FileViewer.tsx - Syntax highlighting reference (lines 454-467)",
        "ConsoleTabs.tsx - Tab styling reference",
        "ContextMenu.tsx - Menu bar dropdown pattern",
        "FileTreeNode.tsx - Clipboard operations reference"
      ],
      "key_patterns": [
        "Industrial theme tokens: --ind-bg, --ind-panel, --ind-border, --ind-text, --ind-accent",
        "Error handling: try-catch blocks in 70 files",
        "File organization: barrel exports in 10 files",
        "Syntax highlighting: react-syntax-highlighter with vscDarkPlus theme"
      ]
    },
    "technology_stack": {
      "language": "TypeScript",
      "framework": "Next.js 16 (App Router)",
      "ui_library": "React 19",
      "styling": "Tailwind CSS with custom design tokens",
      "syntax_highlighting": "react-syntax-highlighter v16.1.0",
      "desktop": "Electron",
      "build_tools": "npm workspaces"
    },
    "project_structure": {
      "monorepo_packages": [
        "packages/core - Shared utilities and components",
        "packages/dashboard - Next.js web application",
        "packages/electron-app - Desktop distribution"
      ],
      "main_directories": [
        "packages/dashboard/src/widgets/notes - Current Notes Widget",
        "packages/dashboard/src/lib/coderef - API client",
        "packages/dashboard/src/app/api/coderef/file - File API routes",
        "packages/core/src/utils - File handlers utilities"
      ]
    },
    "gaps_and_risks": [
      "Low test coverage: 0% (target: â‰¥80%)",
      "FileApi.save() does not exist - CRITICAL blocker",
      "fileHandlers.saveFile() does not exist - CRITICAL blocker",
      "Extension allowlist too restrictive (.md, .txt, .json only)",
      "validateWritePath() restricts to coderef/notes/ - must be modified"
    ]
  },

    "1_executive_summary": {
    "feature_overview": "Transform the Notes Widget from a 3-card multi-note interface into a Microsoft Notepad clone with multi-tab interface, menu bar (File/Edit), and project-wide file operations",
    "business_value": "Provides developers with a built-in text editor for editing project files directly in the dashboard, eliminating context switching to external editors",
    "user_impact": "Enables opening, editing, and saving any text/code file in the project (not just coderef/notes/), with syntax highlighting for 30+ file types and standard Notepad-style UX",
    "technical_approach": "Complete rewrite of NotesWidget.tsx to tab-based architecture, extend File API for project-wide access, integrate react-syntax-highlighter, add Electron pop-out support",
    "estimated_complexity": "High - 8 implementation phases with 5 new components, 3 modified files, cross-platform file pickers, and security hardening",
    "success_criteria": [
      "Users can open any text/code file in the project via File > Open",
      "Users can save changes to any file via File > Save",
      "Multiple files can be open simultaneously in tabs",
      "Syntax highlighting works for 30+ file types",
      "Unsaved changes are tracked per tab with confirmation prompts",
      "All file operations work in both Web and Electron environments"
    ]
  },

    "2_risk_assessment": {
    "critical_risks": [
      {
        "risk": "Security vulnerabilities in path validation",
        "impact": "Directory traversal attacks, unauthorized file access outside project root",
        "likelihood": "High",
        "mitigation": "Comprehensive path validation in validateWritePath(), prevent ../ patterns, verify all paths resolve within project root, test edge cases (symlinks, special chars)"
      },
      {
        "risk": "Cross-platform file picker incompatibility",
        "impact": "Save As functionality breaks in Web or Electron",
        "likelihood": "Medium",
        "mitigation": "Implement platform detection, use Electron IPC for desktop, File System Access API for web, HTML input fallback for compatibility"
      },
      {
        "risk": "Large file performance degradation",
        "impact": "UI freezes or crashes when opening files > 1MB",
        "likelihood": "Medium",
        "mitigation": "File size warning dialog before opening, limit syntax highlighting to first 10,000 lines, consider virtualization for large files"
      }
    ],
    "moderate_risks": [
      {
        "risk": "Breaking changes to existing Notes Widget users",
        "impact": "Users lose access to existing notes in localStorage",
        "likelihood": "Low",
        "mitigation": "Existing notes in coderef/notes/ can still be opened via File > Open, document migration path in release notes"
      }
    ],
    "dependencies": [
      "react-syntax-highlighter v16.1.0 (already installed)",
      "File System Access API (browser support varies)",
      "Electron IPC handlers (must be created)"
    ]
  },

    "3_current_state_analysis": {
    "existing_implementation": {
      "component": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
      "lines_of_code": 194,
      "architecture": "3-card layout with localStorage persistence",
      "state_management": "useLocalNotes hook (150 lines)",
      "api_client": "NotesApi.save() in api-access.ts (restricted to coderef/notes/)",
      "api_route": "PUT /api/coderef/file (restricted to coderef/notes/)",
      "limitations": [
        "Cannot open files outside coderef/notes/",
        "No menu bar or standard Notepad UI",
        "No file picker for Open/Save As",
        "No edit operations (Cut/Copy/Paste/Select All)",
        "No syntax highlighting",
        "Fixed 3-card layout (not tabs)"
      ]
    },
    "existing_apis": {
      "GET /api/coderef/file": "Read file content (lines 283-393, ready to use)",
      "PUT /api/coderef/file": "Write file (lines 178-277, NEEDS MODIFICATION for project-wide access)",
      "DELETE /api/coderef/file": "Delete file (lines 426-536, ready to use)",
      "PATCH /api/coderef/file": "Rename/move file (lines 563-821, ready for Save As)"
    },
    "existing_utilities": {
      "fileHandlers.openFile()": "File picker for Electron/Web (packages/core/src/utils/fileHandlers.ts)",
      "FileApi.load()": "Read file via API (packages/dashboard/src/lib/coderef/api-access.ts line 133)",
      "languageMap.ts": "File extension to language mapping for 30+ types",
      "FileViewer.tsx": "Syntax highlighting reference implementation"
    },
    "blockers": [
      {
        "id": "BLOCK-001",
        "description": "FileApi.save() does not exist",
        "impact": "Cannot save files project-wide",
        "resolution": "Create method in api-access.ts"
      },
      {
        "id": "BLOCK-002",
        "description": "fileHandlers.saveFile() does not exist",
        "impact": "No Save As file picker",
        "resolution": "Add to fileHandlers.ts + Electron IPC handler"
      },
      {
        "id": "BLOCK-003",
        "description": "Extension allowlist too restrictive",
        "impact": "Cannot edit .js, .ts, .py, .html, .css files",
        "resolution": "Expand WRITE_ALLOWED_EXTENSIONS in route.ts"
      }
    ]
  },

    "4_key_features": {
    "feature_list": [
      {
        "id": "FEAT-001",
        "name": "Multi-tab interface",
        "description": "Allow multiple files to be open simultaneously in horizontal tabs",
        "priority": "P0",
        "complexity": "High",
        "dependencies": ["TabBar component", "useNotepadTabs hook"]
      },
      {
        "id": "FEAT-002",
        "name": "Menu bar with File and Edit menus",
        "description": "Standard Notepad-style menu bar with dropdown menus",
        "priority": "P0",
        "complexity": "Medium",
        "dependencies": ["MenuBar component", "ContextMenu pattern"]
      },
      {
        "id": "FEAT-003",
        "name": "Project-wide file operations",
        "description": "Open, Save, Save As for any file in project (not just coderef/notes/)",
        "priority": "P0",
        "complexity": "High",
        "dependencies": ["FileApi.save()", "fileHandlers.saveFile()", "path validation"]
      },
      {
        "id": "FEAT-004",
        "name": "Syntax highlighting for 30+ file types",
        "description": "Color-coded syntax using react-syntax-highlighter with vscDarkPlus theme",
        "priority": "P1",
        "complexity": "Medium",
        "dependencies": ["react-syntax-highlighter", "languageMap.ts"]
      },
      {
        "id": "FEAT-005",
        "name": "Edit operations (Cut/Copy/Paste/Select All)",
        "description": "Standard text editing operations via Clipboard API",
        "priority": "P1",
        "complexity": "Low",
        "dependencies": ["Clipboard API", "textarea focus"]
      },
      {
        "id": "FEAT-006",
        "name": "Unsaved changes tracking",
        "description": "Track dirty state per tab, warn on close, show indicator",
        "priority": "P0",
        "complexity": "Medium",
        "dependencies": ["useNotepadTabs hook", "isDirty state"]
      },
      {
        "id": "FEAT-007",
        "name": "Electron pop-out window",
        "description": "Open notepad in separate window via Electron IPC",
        "priority": "P2",
        "complexity": "Medium",
        "dependencies": ["Electron IPC handler", "BrowserWindow"]
      },
      {
        "id": "FEAT-008",
        "name": "File size warning dialog",
        "description": "Warn before opening files > 1MB with confirmation modal",
        "priority": "P1",
        "complexity": "Low",
        "dependencies": ["Modal component", "file metadata API"]
      }
    ]
  },

    "5_task_id_system": {
    "prefix_definitions": {
      "API": "API route modifications and extensions",
      "CLIENT": "API client method creation",
      "UTIL": "Utility function creation",
      "COMP": "UI component creation",
      "HOOK": "React hook creation",
      "INTEG": "Component integration and wiring",
      "TEST": "Testing and validation",
      "DOC": "Documentation updates"
    },
    "task_id_format": "{PREFIX}-{SEQUENCE}",
    "examples": [
      "API-001: Expand WRITE_ALLOWED_EXTENSIONS to 30+ types",
      "CLIENT-001: Create FileApi.save() method",
      "COMP-001: Create MenuBar component",
      "HOOK-001: Create useNotepadTabs hook"
    ]
  },

    "6_implementation_phases": {
    "phase_1": {
      "name": "API Extensions",
      "objective": "Extend File API to support project-wide file operations with security",
      "tasks": [
        {
          "task_id": "API-001",
          "description": "Expand WRITE_ALLOWED_EXTENSIONS in route.ts to include 30+ file types (.js, .jsx, .ts, .tsx, .py, .html, .css, .scss, .yaml, .json, etc.)",
          "file": "packages/dashboard/src/app/api/coderef/file/route.ts",
          "estimated_effort": "30 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Extension allowlist includes all 30+ types from context.json",
            "PUT handler accepts files with new extensions",
            "Security validation still enforces allowlist"
          ]
        },
        {
          "task_id": "API-002",
          "description": "Modify validateWritePath() to allow project-wide writes (remove coderef/notes/ restriction while maintaining security)",
          "file": "packages/dashboard/src/app/api/coderef/file/route.ts",
          "estimated_effort": "1 hour",
          "dependencies": ["API-001"],
          "acceptance_criteria": [
            "Paths anywhere in project root are allowed",
            "Directory traversal (../) is prevented",
            "Absolute paths are resolved and validated",
            "Paths outside project root are rejected"
          ]
        },
        {
          "task_id": "CLIENT-001",
          "description": "Create FileApi.save() method in api-access.ts for project-wide file writes",
          "file": "packages/dashboard/src/lib/coderef/api-access.ts",
          "estimated_effort": "45 minutes",
          "dependencies": ["API-002"],
          "acceptance_criteria": [
            "Method accepts filePath and content parameters",
            "Calls PUT /api/coderef/file with project root",
            "Returns success/error status",
            "Handles API errors gracefully"
          ]
        },
        {
          "task_id": "CLIENT-002",
          "description": "Create FileApi.open() method as alias for FileApi.load()",
          "file": "packages/dashboard/src/lib/coderef/api-access.ts",
          "estimated_effort": "15 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Method wraps FileApi.load() with same signature",
            "Returns FileData object",
            "Handles API errors gracefully"
          ]
        },
        {
          "task_id": "UTIL-001",
          "description": "Create fileHandlers.saveFile() utility for cross-platform Save As dialog",
          "file": "packages/core/src/utils/fileHandlers.ts",
          "estimated_effort": "1.5 hours",
          "dependencies": [],
          "acceptance_criteria": [
            "Detects Electron vs Web environment",
            "Uses Electron IPC fs:saveFileDialog in Electron",
            "Uses File System Access API showSaveFilePicker() in web",
            "Falls back to HTML download link if API unavailable",
            "Returns selected file path"
          ]
        },
        {
          "task_id": "UTIL-002",
          "description": "Add Electron IPC handler fs:saveFileDialog in main.ts",
          "file": "packages/electron-app/src/main.ts",
          "estimated_effort": "45 minutes",
          "dependencies": ["UTIL-001"],
          "acceptance_criteria": [
            "Handler opens native save dialog",
            "Accepts filters for file types",
            "Returns selected file path",
            "Handles user cancellation"
          ]
        }
      ]
    },
    "phase_2": {
      "name": "UI Components",
      "objective": "Create reusable UI components for Notepad interface",
      "tasks": [
        {
          "task_id": "COMP-001",
          "description": "Create MenuBar component with File and Edit dropdown menus",
          "file": "packages/dashboard/src/widgets/notes/components/MenuBar.tsx",
          "estimated_effort": "2 hours",
          "dependencies": [],
          "acceptance_criteria": [
            "File menu: New, Open, Save, Save As items",
            "Edit menu: Undo, Cut, Copy, Paste, Select All items",
            "Keyboard shortcuts displayed (Ctrl+N, Ctrl+S, etc.)",
            "Dropdown positioning works correctly",
            "Industrial theme styling applied",
            "Click-outside-to-close behavior"
          ]
        },
        {
          "task_id": "COMP-002",
          "description": "Create TabBar component with horizontal tabs and close buttons",
          "file": "packages/dashboard/src/widgets/notes/components/TabBar.tsx",
          "estimated_effort": "2 hours",
          "dependencies": [],
          "acceptance_criteria": [
            "Tabs display file name or 'Untitled'",
            "Active tab highlighted",
            "Unsaved indicator (dot or asterisk) shows when isDirty",
            "Close button (X) on each tab",
            "Tab click switches active tab",
            "Close button prompts if unsaved changes",
            "Industrial theme styling"
          ]
        },
        {
          "task_id": "COMP-003",
          "description": "Create FilePicker component wrapper for Open/Save As dialogs",
          "file": "packages/dashboard/src/widgets/notes/components/FilePicker.tsx",
          "estimated_effort": "1.5 hours",
          "dependencies": ["UTIL-001"],
          "acceptance_criteria": [
            "Uses fileHandlers.openFile() for Open",
            "Uses fileHandlers.saveFile() for Save As",
            "Returns selected file path",
            "Handles user cancellation",
            "Shows appropriate file type filters"
          ]
        },
        {
          "task_id": "COMP-004",
          "description": "Create notepad types (OpenTab, TabState interfaces)",
          "file": "packages/dashboard/src/widgets/notes/types/notepad.ts",
          "estimated_effort": "30 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "OpenTab interface: id, filePath, content, isDirty, lastSaved, fileExtension",
            "TabState interface: tabs array, activeTabId",
            "Exported for use in components and hooks"
          ]
        }
      ]
    },
    "phase_3": {
      "name": "State Management",
      "objective": "Create tab-based state management hook",
      "tasks": [
        {
          "task_id": "HOOK-001",
          "description": "Create useNotepadTabs hook for tab CRUD and state management",
          "file": "packages/dashboard/src/widgets/notes/hooks/useNotepadTabs.ts",
          "estimated_effort": "3 hours",
          "dependencies": ["COMP-004"],
          "acceptance_criteria": [
            "addTab(options) - Create new tab",
            "removeTab(id) - Close tab with unsaved check",
            "setActiveTab(id) - Switch active tab",
            "updateTabContent(id, content) - Update content and set isDirty",
            "markTabSaved(id) - Clear isDirty flag after save",
            "getActiveTab() - Return current active tab",
            "Manages tabs array and activeTabId state",
            "Optional localStorage persistence for tab list"
          ]
        },
        {
          "task_id": "INTEG-001",
          "description": "Rewrite NotesWidget.tsx to use tab-based architecture",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "3 hours",
          "dependencies": ["COMP-001", "COMP-002", "HOOK-001"],
          "acceptance_criteria": [
            "Remove 3-card layout",
            "Add MenuBar at top",
            "Add TabBar below MenuBar",
            "Add single textarea for active tab content",
            "Wire useNotepadTabs hook",
            "Industrial theme styling throughout",
            "Responsive layout (stacks on mobile)"
          ]
        }
      ]
    },
    "phase_4": {
      "name": "File Operations",
      "objective": "Implement New, Open, Save, Save As file operations",
      "tasks": [
        {
          "task_id": "INTEG-002",
          "description": "Implement New file operation (Ctrl+N) - creates new untitled tab",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": ["HOOK-001"],
          "acceptance_criteria": [
            "File > New creates new tab with empty content",
            "Default file extension is .md",
            "Tab shows 'Untitled' as name",
            "Ctrl+N keyboard shortcut works",
            "Multiple untitled tabs supported"
          ]
        },
        {
          "task_id": "INTEG-003",
          "description": "Implement Open file operation (Ctrl+O) - opens file picker and loads file",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "2 hours",
          "dependencies": ["COMP-003", "CLIENT-002"],
          "acceptance_criteria": [
            "File > Open triggers file picker",
            "Selected file loaded via FileApi.open()",
            "File content displayed in new tab",
            "File extension detected and stored",
            "File size > 1MB shows warning dialog",
            "User can cancel warning dialog",
            "Ctrl+O keyboard shortcut works"
          ]
        },
        {
          "task_id": "INTEG-004",
          "description": "Implement Save file operation (Ctrl+S) - saves active tab to existing file or prompts Save As",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "2 hours",
          "dependencies": ["CLIENT-001"],
          "acceptance_criteria": [
            "File > Save saves active tab if filePath exists",
            "If no filePath (untitled), triggers Save As",
            "Calls FileApi.save() with filePath and content",
            "Marks tab as saved (clear isDirty)",
            "Updates lastSaved timestamp",
            "Shows error toast on failure",
            "Ctrl+S keyboard shortcut works"
          ]
        },
        {
          "task_id": "INTEG-005",
          "description": "Implement Save As operation (Ctrl+Shift+S) - opens save file picker and saves to new location",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "2 hours",
          "dependencies": ["COMP-003", "CLIENT-001"],
          "acceptance_criteria": [
            "File > Save As triggers save file picker",
            "Selected path saved via FileApi.save()",
            "Tab filePath updated to new location",
            "Tab name updated to new file name",
            "isDirty cleared after save",
            "Ctrl+Shift+S keyboard shortcut works"
          ]
        }
      ]
    },
    "phase_5": {
      "name": "Edit Operations",
      "objective": "Implement Cut, Copy, Paste, Select All, Undo/Redo",
      "tasks": [
        {
          "task_id": "INTEG-006",
          "description": "Implement Cut operation (Ctrl+X) - copy selection to clipboard and delete",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": [],
          "acceptance_criteria": [
            "Edit > Cut copies selected text to clipboard",
            "Selected text deleted from textarea",
            "Uses navigator.clipboard.writeText()",
            "Falls back to execCommand('cut') if API unavailable",
            "Ctrl+X keyboard shortcut works"
          ]
        },
        {
          "task_id": "INTEG-007",
          "description": "Implement Copy operation (Ctrl+C) - copy selection to clipboard",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "45 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Edit > Copy copies selected text to clipboard",
            "Uses navigator.clipboard.writeText()",
            "Falls back to execCommand('copy') if API unavailable",
            "Ctrl+C keyboard shortcut works"
          ]
        },
        {
          "task_id": "INTEG-008",
          "description": "Implement Paste operation (Ctrl+V) - paste from clipboard",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": [],
          "acceptance_criteria": [
            "Edit > Paste inserts clipboard text at cursor",
            "Uses navigator.clipboard.readText()",
            "Falls back to execCommand('paste') if API unavailable",
            "Ctrl+V keyboard shortcut works",
            "Requests clipboard permission if needed"
          ]
        },
        {
          "task_id": "INTEG-009",
          "description": "Implement Select All operation (Ctrl+A) - select all text in active tab",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "30 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Edit > Select All selects all text in textarea",
            "Uses textarea.select() or setSelectionRange(0, length)",
            "Ctrl+A keyboard shortcut works"
          ]
        },
        {
          "task_id": "INTEG-010",
          "description": "Add Undo/Redo menu items (browser native functionality)",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "30 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Edit > Undo triggers browser native undo",
            "Uses execCommand('undo')",
            "Ctrl+Z keyboard shortcut works (browser default)",
            "No custom undo stack needed for MVP"
          ]
        }
      ]
    },
    "phase_6": {
      "name": "Unsaved Changes Handling",
      "objective": "Track dirty state and warn on close",
      "tasks": [
        {
          "task_id": "INTEG-011",
          "description": "Implement dirty state tracking - set isDirty on content change",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": ["HOOK-001"],
          "acceptance_criteria": [
            "Textarea onChange calls updateTabContent()",
            "isDirty flag set to true on content change",
            "isDirty cleared after successful save",
            "Unsaved indicator visible on tab"
          ]
        },
        {
          "task_id": "INTEG-012",
          "description": "Add close tab confirmation dialog for unsaved changes",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1.5 hours",
          "dependencies": ["INTEG-011"],
          "acceptance_criteria": [
            "Clicking tab close button checks isDirty",
            "If dirty, shows confirmation dialog",
            "Dialog options: Save, Discard, Cancel",
            "Save triggers save operation before close",
            "Discard closes without saving",
            "Cancel keeps tab open"
          ]
        },
        {
          "task_id": "INTEG-013",
          "description": "Add window/browser close warning for unsaved changes",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": ["INTEG-011"],
          "acceptance_criteria": [
            "useEffect sets window.onbeforeunload handler",
            "If any tab has isDirty=true, shows browser warning",
            "User can cancel window close to save changes",
            "Handler removed on component unmount"
          ]
        }
      ]
    },
    "phase_7": {
      "name": "Syntax Highlighting Integration",
      "objective": "Add syntax highlighting for 30+ file types",
      "tasks": [
        {
          "task_id": "INTEG-014",
          "description": "Import react-syntax-highlighter and vscDarkPlus theme",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "15 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Import Prism as SyntaxHighlighter from react-syntax-highlighter",
            "Import vscDarkPlus from react-syntax-highlighter/dist/esm/styles/prism",
            "Import getLanguage from languageMap.ts"
          ]
        },
        {
          "task_id": "INTEG-015",
          "description": "Add Edit/Preview mode toggle for syntax highlighting",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1.5 hours",
          "dependencies": ["INTEG-014"],
          "acceptance_criteria": [
            "Toggle button in MenuBar or toolbar",
            "Edit mode: plain textarea for editing",
            "Preview mode: SyntaxHighlighter for read-only display",
            "State persists per tab",
            "Ctrl+P keyboard shortcut toggles mode"
          ]
        },
        {
          "task_id": "INTEG-016",
          "description": "Apply syntax highlighting in Preview mode based on file extension",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "2 hours",
          "dependencies": ["INTEG-015"],
          "acceptance_criteria": [
            "Language detected from tab.fileExtension via getLanguage()",
            "SyntaxHighlighter uses detected language",
            "vscDarkPlus theme applied",
            "Line numbers shown",
            "Custom styles match industrial theme",
            "Scrolling works for large files"
          ]
        },
        {
          "task_id": "INTEG-017",
          "description": "Add file size warning dialog for files > 1MB before opening",
          "file": "packages/dashboard/src/widgets/notes/NotesWidget.tsx",
          "estimated_effort": "1 hour",
          "dependencies": ["INTEG-003"],
          "acceptance_criteria": [
            "Before loading file, check metadata.size",
            "If > 1MB, show confirmation modal",
            "Modal displays file size in MB",
            "Warning message about performance impact",
            "User can confirm or cancel",
            "If confirmed, proceed with load"
          ]
        }
      ]
    },
    "phase_8": {
      "name": "Electron Window Pop-out",
      "objective": "Enable opening notepad in separate Electron window",
      "tasks": [
        {
          "task_id": "INTEG-018",
          "description": "Add 'Open in New Window' button to MenuBar",
          "file": "packages/dashboard/src/widgets/notes/components/MenuBar.tsx",
          "estimated_effort": "30 minutes",
          "dependencies": [],
          "acceptance_criteria": [
            "Button visible only in Electron environment",
            "Placed in File menu or toolbar",
            "Icon: external link or window icon",
            "Click triggers Electron IPC call"
          ]
        },
        {
          "task_id": "INTEG-019",
          "description": "Create Electron IPC handler for pop-out window",
          "file": "packages/electron-app/src/main.ts",
          "estimated_effort": "2 hours",
          "dependencies": [],
          "acceptance_criteria": [
            "Handler creates new BrowserWindow",
            "Window loads /notes route",
            "Window size: 800x600 default",
            "Window title: 'Notepad - CodeRef Dashboard'",
            "Window has menu bar disabled",
            "Window closes independently"
          ]
        },
        {
          "task_id": "INTEG-020",
          "description": "Optional: Implement state sync between dashboard and pop-out",
          "file": "packages/electron-app/src/main.ts",
          "estimated_effort": "3 hours (optional)",
          "dependencies": ["INTEG-019"],
          "acceptance_criteria": [
            "Tab state synced via Electron IPC",
            "Changes in pop-out reflected in dashboard",
            "Changes in dashboard reflected in pop-out",
            "Closing either window preserves state"
          ]
        }
      ]
    }
  },

    "7_testing_strategy": {
    "unit_tests": [
      "useNotepadTabs hook - tab CRUD operations",
      "FileApi.save() - API client method",
      "FileApi.open() - API client method",
      "fileHandlers.saveFile() - file picker utility",
      "validateWritePath() - security validation"
    ],
    "integration_tests": [
      "File > New creates new tab",
      "File > Open loads file into tab",
      "File > Save saves active tab",
      "File > Save As saves to new location",
      "Edit > Cut/Copy/Paste operations",
      "Tab close with unsaved changes shows confirmation",
      "Syntax highlighting displays correctly for different file types"
    ],
    "e2e_tests": [
      "Full workflow: Open file, edit, save, close tab",
      "Multi-tab workflow: Open multiple files, switch tabs, save all",
      "Electron workflow: Pop-out window, edit file, close window"
    ],
    "security_tests": [
      "Directory traversal prevention (../../../etc/passwd)",
      "Path validation (reject absolute paths)",
      "Extension validation (reject .exe, .sh)",
      "Project root boundary enforcement"
    ],
    "cross_platform_tests": [
      "File picker works in Electron (Windows, macOS, Linux)",
      "File picker works in Web (Chrome, Firefox, Safari)",
      "Syntax highlighting works in all environments"
    ]
  },

    "8_success_criteria": {
    "functional_requirements": [
      "Users can create new files via File > New (Ctrl+N)",
      "Users can open existing files via File > Open (Ctrl+O)",
      "Users can save files via File > Save (Ctrl+S)",
      "Users can save to new location via File > Save As (Ctrl+Shift+S)",
      "Users can edit files with Cut/Copy/Paste/Select All operations",
      "Multiple files can be open simultaneously in tabs",
      "Syntax highlighting works for 30+ file types",
      "Unsaved changes tracked per tab with confirmation prompts",
      "File size warning appears for files > 1MB"
    ],
    "non_functional_requirements": [
      "File operations work in both Web and Electron",
      "Industrial theme styling applied throughout",
      "Responsive layout (mobile/tablet/desktop)",
      "Keyboard shortcuts work for all operations",
      "Security: No directory traversal or unauthorized file access"
    ],
    "performance_requirements": [
      "File open < 500ms for files < 100KB",
      "Tab switching < 100ms",
      "Syntax highlighting < 1s for files < 500KB"
    ]
  },

    "9_implementation_checklist": {
    "pre_implementation": [
      "Review context.json and analysis.json",
      "Review existing NotesWidget implementation",
      "Review FileViewer syntax highlighting pattern",
      "Review security requirements"
    ],
    "phase_1_checklist": [
      "API-001: Expand WRITE_ALLOWED_EXTENSIONS",
      "API-002: Modify validateWritePath()",
      "CLIENT-001: Create FileApi.save()",
      "CLIENT-002: Create FileApi.open()",
      "UTIL-001: Create fileHandlers.saveFile()",
      "UTIL-002: Add Electron IPC handler"
    ],
    "phase_2_checklist": [
      "COMP-001: Create MenuBar component",
      "COMP-002: Create TabBar component",
      "COMP-003: Create FilePicker component",
      "COMP-004: Create notepad types"
    ],
    "phase_3_checklist": [
      "HOOK-001: Create useNotepadTabs hook",
      "INTEG-001: Rewrite NotesWidget.tsx"
    ],
    "phase_4_checklist": [
      "INTEG-002: Implement New file",
      "INTEG-003: Implement Open file",
      "INTEG-004: Implement Save file",
      "INTEG-005: Implement Save As"
    ],
    "phase_5_checklist": [
      "INTEG-006: Implement Cut",
      "INTEG-007: Implement Copy",
      "INTEG-008: Implement Paste",
      "INTEG-009: Implement Select All",
      "INTEG-010: Add Undo/Redo"
    ],
    "phase_6_checklist": [
      "INTEG-011: Implement dirty state tracking",
      "INTEG-012: Add close tab confirmation",
      "INTEG-013: Add window close warning"
    ],
    "phase_7_checklist": [
      "INTEG-014: Import syntax highlighting",
      "INTEG-015: Add Edit/Preview toggle",
      "INTEG-016: Apply syntax highlighting",
      "INTEG-017: Add file size warning"
    ],
    "phase_8_checklist": [
      "INTEG-018: Add pop-out button",
      "INTEG-019: Create IPC handler",
      "INTEG-020: Optional state sync"
    ],
    "post_implementation": [
      "Run all tests",
      "Test in Electron and Web",
      "Test file operations with various file types",
      "Security audit: test path validation",
      "Update documentation",
      "Run /update-docs",
      "Run /archive-feature"
    ]
  }
  }
}
