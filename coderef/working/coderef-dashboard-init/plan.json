{
  "META_DOCUMENTATION": {
    "feature_name": "coderef-dashboard-init",
    "schema_version": "1.0.0",
    "version": "1.0.0",
    "status": "complete",
    "generated_by": "Claude Code",
    "generated_at": "2025-12-23T19:15:00Z",
    "project": "coderef-dashboard",
    "approach": "Brand new project from scratch. Fresh monorepo architecture with unified codebase (one Next.js build for PWA + Electron). Validate infrastructure with single coming-soon widget."
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "project_status": "BRAND NEW - No existing code",
      "approach": "Greenfield development - correct architecture from day 1",
      "existing_code": "NONE - Starting from scratch",
      "technology_stack": {
        "frontend": "Next.js 16+, React 19, TypeScript, Tailwind CSS",
        "backend": "FastAPI (Python 3.13) - to be integrated later",
        "build": "npm workspaces, PyInstaller, electron-builder",
        "deployment": "Vercel/Netlify (PWA), electron-builder (Electron .exe)"
      },
      "key_decisions": {
        "single_build": "One Next.js build serves both PWA and Electron",
        "bundled_backend": "Python backend bundled in Electron, optional for PWA",
        "widget_interface": "Strict TypeScript contract for all widgets",
        "monorepo": "npm workspaces with 4 packages"
      },
      "scope": "Setup infrastructure only. Come-soon widget validates the system. No real features yet.",
      "focus": "Correct plumbing. All code tested with 1 widget."
    },
    "1_executive_summary": {
      "vision": "Create coderef-dashboard as a clean, production-ready monorepo with modular widget architecture. Start with correct infrastructure, validate with simple coming-soon widget.",
      "success_definition": "Coming-soon widget renders identically in PWA and Electron. Infrastructure is sound and ready for real widgets in Phase 2.",
      "deliverables": [
        "Monorepo with npm workspaces: core, widgets, dashboard, electron-app",
        "IScriptboardWidget interface and types",
        "WidgetLoader component with error boundaries",
        "WidgetRegistry system with JSON config",
        "Next.js app with PWA support",
        "Electron wrapper with IPC bridge",
        "@coderef-dashboard/widget-coming-soon package",
        "Coming-soon widget visible in both PWA and Electron",
        "All code tested and working"
      ],
      "timeline": "5-7 days of focused development",
      "team_size": "1 developer working sequentially"
    },
    "2_risk_assessment": {
      "overall_risk": "LOW - Fresh project, small scope, proven patterns",
      "specific_risks": [
        {
          "risk": "Monorepo build complexity",
          "probability": "LOW",
          "impact": "MEDIUM",
          "mitigation": "Use standard npm workspaces, test early"
        },
        {
          "risk": "PWA service worker caching issues",
          "probability": "MEDIUM",
          "impact": "MEDIUM",
          "mitigation": "Use cache versioning, test offline mode"
        },
        {
          "risk": "Electron IPC bridge communication",
          "probability": "MEDIUM",
          "impact": "LOW",
          "mitigation": "Start with simple ping/pong, add complexity after validation"
        },
        {
          "risk": "Widget rendering differences PWA vs Electron",
          "probability": "MEDIUM",
          "impact": "HIGH",
          "mitigation": "Test both platforms frequently, use shared CSS"
        }
      ],
      "mitigation_strategy": "Test each component as soon as it's built. Use coming-soon widget to catch issues early."
    },
    "3_current_state_analysis": {
      "files_to_create": [
        {
          "path": "package.json",
          "purpose": "Root monorepo with npm workspaces"
        },
        {
          "path": "packages/core/package.json",
          "purpose": "Shared types and utilities"
        },
        {
          "path": "packages/core/src/types/widget.ts",
          "purpose": "IScriptboardWidget interface"
        },
        {
          "path": "packages/widgets/package.json",
          "purpose": "Widgets monorepo"
        },
        {
          "path": "packages/widgets/@coderef-dashboard/widget-coming-soon/package.json",
          "purpose": "Coming-soon widget"
        },
        {
          "path": "packages/dashboard/package.json",
          "purpose": "Next.js PWA app"
        },
        {
          "path": "packages/dashboard/public/manifest.json",
          "purpose": "PWA manifest"
        },
        {
          "path": "packages/dashboard/public/service-worker.js",
          "purpose": "Service worker for offline"
        },
        {
          "path": "packages/dashboard/next.config.js",
          "purpose": "Next.js config with PWA"
        },
        {
          "path": "packages/electron-app/package.json",
          "purpose": "Electron app entry point"
        },
        {
          "path": "packages/electron-app/main.ts",
          "purpose": "Electron main process"
        },
        {
          "path": "packages/electron-app/preload.ts",
          "purpose": "IPC bridge"
        },
        {
          "path": "coderef-dashboard.config.json",
          "purpose": "Widget registry configuration"
        }
      ]
    },
    "4_key_features": [
      {
        "feature": "IScriptboardWidget Interface",
        "description": "Strict TypeScript contract for all widgets with lifecycle hooks"
      },
      {
        "feature": "Widget Loader",
        "description": "Dynamic import system with error boundaries"
      },
      {
        "feature": "Widget Registry",
        "description": "JSON-based discovery and configuration"
      },
      {
        "feature": "Unified Codebase",
        "description": "Single Next.js build for PWA + Electron"
      },
      {
        "feature": "PWA Support",
        "description": "Manifest, service worker, offline functionality"
      },
      {
        "feature": "Electron Wrapper",
        "description": "Electron app with IPC bridge and backend bundling"
      },
      {
        "feature": "Coming-Soon Widget",
        "description": "Proof-of-concept widget to validate infrastructure"
      }
    ],
    "5_task_id_system": {
      "workorder": {
        "id": "WO-CODEREF-DASHBOARD-INIT-001",
        "name": "CodeRef Dashboard Init",
        "feature_name": "coderef-dashboard-init",
        "feature_dir": "coderef/working/coderef-dashboard-init"
      },
      "tasks": [
        {
          "id": "SETUP-001",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Create monorepo root and package.json with npm workspaces",
          "description": "Setup root package.json with workspaces pointing to packages/core, packages/widgets, packages/dashboard, packages/electron-app",
          "acceptance_criteria": ["npm install works", "npm run build:ws executes"]
        },
        {
          "id": "SETUP-002",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Create packages/core with widget interface",
          "description": "Build @coderef-dashboard/core with IScriptboardWidget interface in TypeScript",
          "acceptance_criteria": ["IScriptboardWidget defined", "Error boundary component", "Exports from src/index.ts"]
        },
        {
          "id": "SETUP-003",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Create packages/dashboard (Next.js app)",
          "description": "Setup Next.js 16 app with TypeScript, Tailwind CSS, @coderef-dashboard/core dependency",
          "acceptance_criteria": ["npm run build works", "npm run dev starts", "Next.js app loads"]
        },
        {
          "id": "SETUP-004",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Add PWA support to dashboard",
          "description": "Create manifest.json, service-worker.js, update next.config.js for PWA",
          "acceptance_criteria": ["Service worker registers", "App installable", "Offline mode works"]
        },
        {
          "id": "SETUP-005",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Build WidgetLoader and WidgetRegistry",
          "description": "Create dynamic widget loading system with error boundaries. Create registry that reads from config.",
          "acceptance_criteria": ["WidgetLoader component works", "WidgetRegistry discovers widgets", "Error boundary prevents crashes"]
        },
        {
          "id": "SETUP-006",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Create coderef-dashboard.config.json",
          "description": "Widget configuration file with coming-soon widget entry",
          "acceptance_criteria": ["Valid JSON", "Includes coming-soon widget", "Documented structure"]
        },
        {
          "id": "SETUP-007",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Setup packages/electron-app",
          "description": "Create Electron wrapper with main.ts, preload.ts, IPC bridge, electron-builder config",
          "acceptance_criteria": ["Electron main process", "IPC bridge works (ping/pong)", "electron-builder configured"]
        },
        {
          "id": "SETUP-008",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Configure backend bundling in Electron",
          "description": "Setup electron-builder to include Python backend .exe as asset. Spawn backend on app start.",
          "acceptance_criteria": ["Backend .exe included in build", "IPC health check endpoint", "Backend starts with app"]
        },
        {
          "id": "WIDGET-001",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Create coming-soon widget package",
          "description": "Build @coderef-dashboard/widget-coming-soon with simple card component",
          "acceptance_criteria": ["Implements IScriptboardWidget", "ComingSoonCard component", "TypeScript compiles"]
        },
        {
          "id": "WIDGET-002",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Wire coming-soon widget into loader",
          "description": "Add widget to config, verify registry discovers it, loader renders it",
          "acceptance_criteria": ["Widget visible in PWA", "Widget visible in Electron"]
        },
        {
          "id": "TEST-001",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Test PWA: npm run dev",
          "description": "Launch PWA locally, verify coming-soon card renders, test offline mode",
          "acceptance_criteria": ["PWA starts", "Coming-soon card visible", "Offline mode works"]
        },
        {
          "id": "TEST-002",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Test Electron: npm run dev:electron",
          "description": "Launch Electron app, verify coming-soon card renders identically to PWA",
          "acceptance_criteria": ["Electron starts", "Coming-soon card visible", "Identical to PWA rendering"]
        },
        {
          "id": "TEST-003",
          "workorder_id": "WO-CODEREF-DASHBOARD-INIT-001",
          "title": "Verify infrastructure is solid",
          "description": "Test error boundary, widget config changes, monorepo builds, installer creation",
          "acceptance_criteria": ["Error boundary works", "Config changes work", "Full build succeeds", "Installer created"]
        }
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Monorepo & Infrastructure",
          "description": "Setup npm workspaces, core package, dashboard PWA, electron-app",
          "tasks": ["SETUP-001", "SETUP-002", "SETUP-003", "SETUP-004", "SETUP-005", "SETUP-006", "SETUP-007", "SETUP-008"],
          "deliverables": [
            "Root package.json with npm workspaces configured",
            "@coderef-dashboard/core package with widget interface",
            "Next.js app in packages/dashboard with PWA support",
            "WidgetLoader and WidgetRegistry systems",
            "coderef-dashboard.config.json widget registry",
            "Electron wrapper with IPC bridge",
            "Backend bundling configuration"
          ],
          "success_criteria": [
            "npm run build works across all packages",
            "npm run dev starts PWA",
            "npm run dev:electron starts Electron",
            "IPC bridge responds to pings"
          ]
        },
        {
          "phase": 2,
          "name": "Coming-Soon Widget",
          "description": "Create and integrate coming-soon widget",
          "tasks": ["WIDGET-001", "WIDGET-002"],
          "deliverables": [
            "@coderef-dashboard/widget-coming-soon package",
            "ComingSoonCard component",
            "Widget integrated into registry",
            "Widget visible in both PWA and Electron"
          ],
          "success_criteria": [
            "Widget implements IScriptboardWidget",
            "Registry discovers widget",
            "Loader renders widget",
            "Widget visible in both PWA and Electron"
          ]
        },
        {
          "phase": 3,
          "name": "Validation & Testing",
          "description": "Test in both environments, verify infrastructure",
          "tasks": ["TEST-001", "TEST-002", "TEST-003"],
          "deliverables": [
            "Tested PWA with coming-soon widget",
            "Tested Electron app with coming-soon widget",
            "Verified infrastructure robustness",
            "Documented setup and architecture"
          ],
          "success_criteria": [
            "Coming-soon card identical in PWA and Electron",
            "PWA works offline",
            "Electron includes bundled backend",
            "Infrastructure is sound and tested"
          ]
        }
      ]
    },
    "7_testing_strategy": {
      "edge_cases": [
        {
          "scenario": "Widget missing from registry",
          "expected_behavior": "WidgetRegistry returns undefined, WidgetLoader displays error boundary, app continues"
        },
        {
          "scenario": "Widget render throws error",
          "expected_behavior": "Error boundary catches error, shows error message, app continues running"
        },
        {
          "scenario": "Widget missing IScriptboardWidget interface",
          "expected_behavior": "TypeScript compilation fails or runtime type check prevents load"
        },
        {
          "scenario": "coderef-dashboard.config.json is invalid JSON",
          "expected_behavior": "App startup fails with clear error message, JSON parsing error logged"
        },
        {
          "scenario": "Widget package not found in node_modules",
          "expected_behavior": "Dynamic import fails, error boundary catches it, error displayed to user"
        },
        {
          "scenario": "Widget onEnable throws error",
          "expected_behavior": "Widget marked as disabled, error logged, app continues without widget"
        },
        {
          "scenario": "IPC bridge receives malformed message",
          "expected_behavior": "Message validation fails, error logged, IPC connection remains open"
        },
        {
          "scenario": "Backend process fails to start in Electron",
          "expected_behavior": "IPC health check fails, warning displayed, app continues (backend optional)"
        },
        {
          "scenario": "Service worker fails to register in PWA",
          "expected_behavior": "App continues but offline support unavailable, warning logged"
        },
        {
          "scenario": "User disables widget in config while app running",
          "expected_behavior": "Requires app restart to take effect (documented limitation)"
        }
      ],
      "unit_tests": [
        "IScriptboardWidget interface compliance",
        "WidgetRegistry.getWidgets() returns enabled widgets",
        "WidgetRegistry.getWidget(id) returns correct widget",
        "WidgetRegistry handles missing widget gracefully",
        "WidgetLoader renders widget from registry",
        "WidgetLoader handles null/undefined widget data",
        "Error boundary catches widget errors",
        "Error boundary prevents error propagation to parent"
      ],
      "integration_tests": [
        "PWA builds and loads",
        "Service worker registers and caches",
        "Offline mode works (DevTools offline)",
        "App works offline without network",
        "Electron app launches successfully",
        "IPC bridge communicates with main process",
        "IPC ping/pong heartbeat works",
        "Backend spawns and responds to health check",
        "Coming-soon widget visible in both PWA and Electron"
      ],
      "e2e_tests": [
        "PWA install to home screen works",
        "Electron installer creation succeeds",
        "Electron installer installs cleanly",
        "Coming-soon card renders identically in both",
        "App works offline (PWA) without network",
        "Widget error doesn't crash entire app",
        "Error boundary displays user-friendly message"
      ]
    },
    "8_success_criteria": {
      "primary": [
        "Coming-soon widget renders identically in PWA and Electron",
        "All infrastructure tested and working",
        "Monorepo builds successfully",
        "Ready to add real widgets in Phase 2"
      ],
      "metrics": {
        "build_time": "< 2 minutes",
        "pwa_startup": "< 3 seconds",
        "electron_startup": "< 5 seconds",
        "lighthouse_score": "> 90",
        "bundle_size": "< 250MB for Electron"
      }
    },
    "9_implementation_checklist": {
      "0": [],
      "1": ["SETUP-001", "SETUP-002", "SETUP-003", "SETUP-004", "SETUP-005", "SETUP-006", "SETUP-007", "SETUP-008"],
      "2": ["WIDGET-001", "WIDGET-002"],
      "3": ["TEST-001", "TEST-002", "TEST-003"]
    }
  }
}
