{
  "workorder_id": "WO-RESTRUCTURE-MONOREPO-001",
  "feature_name": "restructure-monorepo",
  "analysis_date": "2025-12-25T18:15:00Z",
  "project_structure": {
    "type": "monorepo",
    "package_manager": "npm workspaces",
    "packages": [
      "packages/core",
      "packages/widgets/@coderef-dashboard/widget-prompting-workflow",
      "packages/dashboard",
      "packages/electron-app"
    ]
  },
  "foundation_docs_status": {
    "ARCHITECTURE.md": "present",
    "SCHEMA.md": "present",
    "COMPONENTS.md": "not_applicable_for_this_feature",
    "project-context.json": "present"
  },
  "coding_standards": {
    "language": "TypeScript 5.3.3",
    "styling": "CSS Modules",
    "component_style": "React functional components",
    "build_tool": "esbuild (widgets), Turbopack (dashboard)"
  },
  "technology_stack": {
    "frontend": ["React 19", "Next.js 16.1.1"],
    "desktop": "Electron",
    "build": ["esbuild", "Turbopack", "electron-builder"],
    "testing": "Not configured",
    "type_checking": "TypeScript"
  },
  "key_patterns_identified": {
    "custom_build_system": {
      "location": "scripts/build-widgets.js",
      "purpose": "IIFE widget bundling",
      "complexity": "high",
      "status": "to be removed"
    },
    "global_type_declarations": {
      "issue": "Multiple packages declare Window.CodeRefCore with different signatures",
      "files_affected": [
        "packages/core/src/index.ts",
        "packages/widgets/@coderef-dashboard/widget-prompting-workflow/src/hooks/useClipboard.ts",
        "packages/widgets/@coderef-dashboard/widget-prompting-workflow/src/hooks/useFileHandlers.ts"
      ],
      "severity": "critical",
      "solution": "Remove widget package entirely"
    },
    "component_migration": {
      "source": "packages/widgets/@coderef-dashboard/widget-prompting-workflow",
      "destination": "packages/dashboard/src/components/PromptingWorkflow",
      "component_count": 8,
      "utility_count": 7,
      "hook_count": 3
    }
  },
  "current_architecture_issues": [
    {
      "issue": "TypeScript type conflicts",
      "impact": "Build fails with type declaration errors",
      "root_cause": "Duplicate Window.CodeRefCore declarations in multiple packages",
      "severity": "critical"
    },
    {
      "issue": "Widget system overhead",
      "impact": "Complex build process with custom IIFE bundling",
      "root_cause": "Original architecture designed for loadable widgets, now using direct components",
      "severity": "major"
    },
    {
      "issue": "Build coupling",
      "impact": "npm run build must succeed build:widgets phase first",
      "root_cause": "package.json build script: 'npm run build:widgets && npm run build -ws'",
      "severity": "major"
    }
  ],
  "project_structure_analysis": {
    "monorepo_justification": "Reasonable for web + desktop apps, but widget system is unnecessary",
    "recommended_structure": {
      "keep": ["packages/core", "packages/dashboard", "packages/electron-app"],
      "remove": ["packages/widgets/"],
      "reasoning": "Single component doesn't warrant separate widget infrastructure"
    }
  },
  "risks_and_gaps": [
    {
      "risk": "TypeScript compilation during restructuring",
      "mitigation": "Carefully remove type declarations in order"
    },
    {
      "risk": "Both web and Electron apps must continue working",
      "mitigation": "Test both platforms after each major change"
    },
    {
      "risk": "Component code already exists in two locations",
      "mitigation": "Use the completed component version from packages/dashboard/src/widgets/"
    }
  ],
  "implementation_readiness": {
    "prerequisite_work": "PromptingWorkflow component is already fully implemented",
    "estimated_complexity": "medium",
    "estimated_phases": 5,
    "dependencies": "None - this is a pure refactoring"
  }
}
