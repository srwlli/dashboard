---
agent: Claude Sonnet 4.5
date: "2026-01-12"
task: UPDATE
subject: FileViewer
parent_project: coderef-dashboard
category: component
version: 1.0.0
related_files:
  - packages/dashboard/src/components/coderef/FileViewer.tsx
status: APPROVED
---

# FileViewer - Resource Sheet

**Category:** UI Component
**Type:** React Client Component
**File:** `packages/dashboard/src/components/coderef/FileViewer.tsx`
**Created:** 2026-01-04
**Lines of Code:** ~300
**Complexity:** Medium

---

**Generated by:** Resource Sheet Generation Workflow
**Timestamp:** 2026-01-04
**Auto-fill Rate:** Manual (comprehensive analysis)

---

## Executive Summary

**Element:** FileViewer
**Category:** UI Component
**Purpose:** Displays file contents with syntax highlighting, rich media rendering (Markdown, Mermaid, HTML), and utility features (Copy, Share, Expand).

**Key Responsibilities:**
- Fetching file content via `hybrid-router` (Local or API).
- Rendering different file types appropriately:
  - **Code:** Syntax highlighting via `react-syntax-highlighter`.
  - **Markdown:** Rich text via `react-markdown` with syntax-highlighted code blocks.
  - **Mermaid:** Diagrams via `MermaidViewer`.
  - **HTML:** Sandboxed iframe preview.
  - **JSON:** Pretty-printed.
- Managing loading, error, and empty states.
- Providing utility actions: Copy Path, Copy Content, Share, Expand to Full Page.

**Not Responsible For:**
- File editing (Read-only).
- File tree navigation.
- Project selection.

---

## Architecture Overview

### Dependencies

**Internal:**
- `hybrid-router`: For loading content (`loadFileContent`).
- `types`: For `Project`, `FileInfo`, `AccessMode`.
- `MermaidViewer`: For rendering `.mmd` files.

**External:**
- `react-syntax-highlighter`: For code blocks.
- `react-markdown`: For `.md` files.
- `rehype-slug`: For Markdown anchor links.
- `lucide-react`: For icons.

### State Management

- `fileData` (`FileInfo | null`): Content and metadata of the current file.
- `loading` (`boolean`): Fetch status.
- `error` (`string | null`): Error message.
- `accessMode` (`'local' | 'api'`): Indicator of how the file was loaded (via File System Access API or HTTP).
- `copied`, `copiedPath`, `shared` (`boolean`): Transient UI states for button feedback.

### Data Flow

1. **Props Change:** `project` or `filePath` updates.
2. **Effect Trigger:** `useEffect` calls `loadFile`.
3. **Fetch:** `loadFileContent` (hybrid router) determines best loading method.
4. **Render:**
   - Checks extension (`.ts`, `.md`, etc.).
   - Selects appropriate renderer (SyntaxHighlighter, ReactMarkdown, etc.).

---

## Supported Formats

| Type | Extensions | Renderer |
| :--- | :--- | :--- |
| **Code** | `.ts`, `.js`, `.py`, `.java`, `.go`, etc. | `Prism` (VSCode Dark Plus) |
| **Markdown** | `.md` | `ReactMarkdown` + `rehype-slug` |
| **Mermaid** | `.mmd` | `<MermaidViewer />` |
| **HTML** | `.html`, `.htm` | `<iframe sandbox="..." />` |
| **JSON** | `.json` | `JSON.stringify(parsed, null, 2)` |
| **Binary** | Images, etc. | "Binary file preview not available" |

---

## Integration Points

- **Parent:** Typically rendered by `CodeRefExplorerWidget` or `FullPageViewer`.
- **Navigation:** Uses `useRouter` for "Expand" functionality (navigates to `/viewer/full`).
- **Storage:** Writes to `sessionStorage` (`fullPageViewerProject`) to pass context to the full-page viewer without URL clutter.

---

## Common Pitfalls

1.  **Binary Files:** Currently shows a placeholder. No image preview yet.
2.  **Large Files:** No virtualization. Very large files (>1MB) might lag the DOM.
3.  **Encoding:** Assumes UTF-8. Base64 content is strictly for binary detection, not decoding.

---

**Complexity Score:** Medium
**Modules Used:** syntax-highlighting, markdown-rendering, hybrid-routing
