---
agent: Claude Sonnet 4.5
date: "2026-01-17"
task: CREATE
subject: TreeActionsToolbar
parent_project: coderef-dashboard
category: component
version: 1.0.0
created: "2026-01-17"
updated: "2026-01-17"
status: APPROVED
complexity: low
loc: 94
dependencies: ["React", "lucide-react"]
related_files:
  - packages/dashboard/src/components/coderef/TreeActionsToolbar.tsx
related_sheets:
  - FileTree-RESOURCE-SHEET.md
  - CodeRef-Explorer-Widget-RESOURCE-SHEET.md
workorder_id: WO-EXPLORER-SIDEBAR-UX-001
feature_id: explorer-sidebar-ux-improvements
phase: phase_2
---

# TreeActionsToolbar - Resource Sheet

**Category:** UI Component
**Type:** React Component (Client Component)
**File:** `packages/dashboard/src/components/coderef/TreeActionsToolbar.tsx`
**Created:** 2026-01-17 (Phase 2 Navigation Enhancements)
**Lines of Code:** 94
**Complexity:** Low

---

**Generated by:** coderef-docs agent (WO-EXPLORER-SIDEBAR-UX-001-DOCS-PHASE2)
**Timestamp:** 2026-01-17
**Context:** Phase 2 Explorer sidebar navigation enhancements

---

## Executive Summary

**Element:** TreeActionsToolbar
**Category:** UI Component (Action Toolbar)
**Purpose:** Toolbar component providing quick actions for file tree management including expand all, collapse all, and refresh operations

**Key Responsibilities:**
- Render three action buttons with icons (Expand All, Collapse All, Refresh)
- Provide callback props for each action (optional)
- Show tooltips on hover for button descriptions
- Apply hover states for visual feedback
- Maintain accessible button labels (ARIA)

**Not Responsible For:**
- Tree expand/collapse state management (delegated to FileTree)
- Tree data fetching or reloading (delegated to parent)
- Button visibility logic (all buttons always visible)
- Action execution logic (delegated to callback handlers)

**Phase 2 Status:**
- ‚úÖ Refresh button: Fully functional (wired to parent handler)
- ‚ö†Ô∏è Expand All / Collapse All: UI-only (not wired, deferred to Phase 3)

---

## Architecture Overview

### Component Hierarchy

```
TreeActionsToolbar (this component)
‚îú‚îÄ‚îÄ Container (horizontal flex layout)
‚îÇ   ‚îú‚îÄ‚îÄ Expand All Button
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChevronDown Icon (lucide-react)
‚îÇ   ‚îú‚îÄ‚îÄ Collapse All Button
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChevronRight Icon (lucide-react)
‚îÇ   ‚îî‚îÄ‚îÄ Refresh Button
‚îÇ       ‚îî‚îÄ‚îÄ RotateCw Icon (lucide-react)
```

**Design Rationale:**
- **Icon-only buttons:** Save space, visual clarity in compact toolbar
- **Tooltips via aria-label:** Accessibility without cluttering UI
- **Horizontal layout:** Natural left-to-right action flow
- **Consistent spacing:** gap-1 between buttons for visual rhythm
- **Optional callbacks:** Buttons can be present but non-functional (future-proofing)

### File Structure

**Location:** `packages/dashboard/src/components/coderef/TreeActionsToolbar.tsx`

**Related Files:**
- `components/coderef/FileTree.tsx` - Consumer of expand/collapse actions (future)
- `widgets/coderef-explorer/CodeRefExplorerWidget.tsx` - Parent providing onRefresh handler

**Organization Strategy:**
- Component handles UI rendering only
- Parent component provides action handlers via props
- FileTree handles tree state (not yet exposed for expand/collapse)

### Dependencies

**Internal Dependencies:**
- None (pure presentational component)

**External Dependencies:**
- `react` (^18.2.0) - JSX rendering
- `lucide-react` - ChevronDown, ChevronRight, RotateCw icons
- `next` (^14.0.0) - 'use client' directive for client-side rendering

**Dependency Choices:**
- **lucide-react icons:** Consistent with existing icon system in dashboard
- **No tooltip library:** aria-label sufficient for accessibility
- **No state library:** Stateless component, all state in parent

### Architectural Pattern

**Pattern:** Presentational Component (Stateless)

**Rationale:**
- Component has zero internal state
- All actions delegated to parent via callbacks
- Pure function of props ‚Üí UI
- Easy to test (no state to mock)

**Alternative Considered:** Smart component managing tree state
**Rejected Because:**
- Violates single responsibility principle
- Tree state belongs in FileTree or parent, not toolbar
- Would duplicate state management logic

### Design Principles

**Principles Applied:**
- **Single Responsibility:** Toolbar renders buttons only
- **Separation of Concerns:** Action execution separate from UI
- **Accessibility First:** ARIA labels, keyboard navigation
- **Progressive Enhancement:** Works without all callbacks (degraded mode)
- **Visual Consistency:** Matches existing button patterns

**Evidence in Code:**
```tsx
// Optional callback pattern - button works even if callback missing
<button
  onClick={onRefresh}
  disabled={!onRefresh} // Disabled if no handler provided
  aria-label="Refresh tree"
>
  <RotateCw className="h-4 w-4" />
</button>
```

---

## Component API

### Props

```typescript
interface TreeActionsToolbarProps {
  onExpandAll?: () => void;    // Callback to expand all tree nodes
  onCollapseAll?: () => void;  // Callback to collapse all tree nodes
  onRefresh?: () => void;      // Callback to refresh tree data
}
```

**Prop Details:**

**1. onExpandAll (optional)**
- **Type:** `() => void`
- **Purpose:** Callback invoked when user clicks Expand All button
- **Status:** Not wired in Phase 2 (button disabled)
- **Future:** Will expand all collapsed tree nodes recursively
- **Default:** undefined (button disabled if not provided)

**2. onCollapseAll (optional)**
- **Type:** `() => void`
- **Purpose:** Callback invoked when user clicks Collapse All button
- **Status:** Not wired in Phase 2 (button disabled)
- **Future:** Will collapse all expanded tree nodes recursively
- **Default:** undefined (button disabled if not provided)

**3. onRefresh (optional)**
- **Type:** `() => void`
- **Purpose:** Callback invoked when user clicks Refresh button
- **Status:** ‚úÖ Fully functional in Phase 2
- **Behavior:** Parent increments refreshKey, forces FileTree remount
- **Default:** undefined (button disabled if not provided)

---

## State Management

### Component State

**This component has ZERO internal state.**

All state managed externally by parent component (CodeRefExplorerWidget).

### Parent State (CodeRefExplorerWidget)

**refreshKey: number**
- **Purpose:** Forces FileTree remount when incremented
- **Updated by:** onRefresh callback
- **Pattern:** `setRefreshKey(prev => prev + 1)`

**Tree Expansion State (Future):**
- **Status:** Not yet exposed by FileTree
- **Issue:** FileTreeNode uses internal isExpanded state (not lifted)
- **Deferred to:** Phase 3 (requires FileTree refactoring)

---

## Integration Points

### Internal Integrations

**Components that use this:**
- `CodeRefExplorerWidget` - Parent component providing onRefresh handler

**Integration Pattern:**
```tsx
// CodeRefExplorerWidget.tsx
const [refreshKey, setRefreshKey] = useState(0);

const handleRefresh = () => {
  setRefreshKey(prev => prev + 1);
};

<TreeActionsToolbar
  onRefresh={handleRefresh}
  // onExpandAll and onCollapseAll omitted (not implemented)
/>

<FileTree
  key={refreshKey}  // Forces remount when refreshKey changes
  {...otherProps}
/>
```

**Data Flow:**
1. User clicks Refresh button
2. onRefresh fires, calls parent's handleRefresh
3. Parent increments refreshKey state
4. FileTree re-mounts with new key
5. Tree data reloads from filesystem/API

### External Integrations

**Browser APIs:** None (component doesn't interact with DOM directly)

**External Services:** None (pure UI component)

### Failure Modes

**Upstream Failures:**
- **Parent doesn't provide onRefresh:** Button appears disabled (no effect)
- **onRefresh throws error:** Parent error boundary handles

**Downstream Impact:**
- **Component crashes:** Error boundary in root layout catches error
- **Button click throws:** Error propagates to parent

**Isolation:**
- ‚úÖ Zero internal state (no state corruption risk)
- ‚úÖ No global mutations
- ‚úÖ No side effects beyond callbacks
- Blast radius: Limited to toolbar UI only

---

## Visual Design

### Button Styling

**Default State:**
- Background: transparent
- Text color: text-ind-text (gray)
- Padding: p-1.5
- Border radius: rounded

**Hover State:**
- Background: bg-ind-panel (light gray)
- Text color: text-ind-accent (blue)
- Transition: smooth color change

**Disabled State:**
- Opacity: 50%
- Cursor: not-allowed
- No hover effect

### Icon Sizing

All icons: `h-4 w-4` (16px √ó 16px)

**Icons Used:**
- **Expand All:** ChevronDown (suggests expanding downward)
- **Collapse All:** ChevronRight (suggests collapsing sideways)
- **Refresh:** RotateCw (universal refresh symbol)

### Layout

**Container:**
- Display: flex
- Direction: row (horizontal)
- Gap: gap-1 (4px between buttons)
- Alignment: items-center

**Total Width:** ~120px (3 buttons √ó 40px each)

---

## Accessibility

### ARIA Labels

**Expand All Button:**
```tsx
<button aria-label="Expand all folders">
  <ChevronDown />
</button>
```

**Collapse All Button:**
```tsx
<button aria-label="Collapse all folders">
  <ChevronRight />
</button>
```

**Refresh Button:**
```tsx
<button aria-label="Refresh tree">
  <RotateCw />
</button>
```

### Keyboard Navigation

- ‚úÖ All buttons keyboard accessible (native button element)
- ‚úÖ Tab order: left to right (Expand ‚Üí Collapse ‚Üí Refresh)
- ‚úÖ Enter/Space to activate button
- ‚úÖ Focus visible (browser default outline)

### Screen Reader Support

- ‚úÖ aria-label provides button purpose
- ‚úÖ Disabled state announced by screen readers
- ‚úÖ Icon-only buttons still accessible (label describes action)

---

## Testing Strategy

### Recommended Test Coverage

**Unit Tests:**
- ‚úÖ Renders three buttons (Expand All, Collapse All, Refresh)
- ‚úÖ Expand All button disabled when onExpandAll not provided
- ‚úÖ Collapse All button disabled when onCollapseAll not provided
- ‚úÖ Refresh button disabled when onRefresh not provided
- ‚úÖ Refresh button calls onRefresh when clicked
- ‚úÖ Buttons have correct aria-labels
- ‚úÖ Icons render correctly (ChevronDown, ChevronRight, RotateCw)

**Integration Tests:**
- ‚úÖ Clicking Refresh button increments parent refreshKey
- ‚úÖ FileTree remounts after refresh
- ‚úÖ Expand/Collapse buttons remain disabled (Phase 2 limitation)

**Accessibility Tests:**
- ‚úÖ All buttons keyboard navigable
- ‚úÖ aria-labels present
- ‚úÖ Focus visible on tab navigation

### Test Files (Recommended Structure)

**Unit Tests:**
- `__tests__/TreeActionsToolbar.test.tsx` - Component rendering and callbacks

**Integration Tests:**
- `__tests__/TreeActionsToolbar.integration.test.tsx` - Integration with FileTree refresh

### Coverage Gaps

**Missing Tests (to be implemented by coderef-testing agent):**
- [ ] Expand/Collapse All functionality (when implemented in Phase 3)
- [ ] Tooltip display on hover (if tooltips added)
- [ ] Multiple toolbar instances (shouldn't interfere)

---

## Common Pitfalls

### Pitfall 1: Expecting Expand/Collapse to Work

**Issue:** Buttons are present but non-functional in Phase 2

**Why:** FileTree doesn't expose expansion state yet
**Resolution:** Document clearly that these are deferred to Phase 3

### Pitfall 2: Not Disabling Buttons Without Callbacks

**Issue:** Buttons clickable but do nothing

**Wrong:**
```tsx
<button onClick={onRefresh}> {/* Still clickable if undefined */}
  <RotateCw />
</button>
```

**Correct:**
```tsx
<button onClick={onRefresh} disabled={!onRefresh}>
  <RotateCw />
</button>
```

### Pitfall 3: Missing ARIA Labels

**Issue:** Screen readers can't describe icon-only buttons

**Wrong:**
```tsx
<button>
  <RotateCw />
</button>
```

**Correct:**
```tsx
<button aria-label="Refresh tree">
  <RotateCw />
</button>
```

---

## Phase 3 Enhancements

### Expand/Collapse All Implementation

**Requirement:** Lift expansion state from FileTreeNode to FileTree

**Current Issue:**
- FileTreeNode uses internal `isExpanded` state (useState)
- Parent components can't control expansion

**Solution:**
1. Refactor FileTree to manage all expansion state
2. Pass `expandedNodes: Set<string>` as prop
3. Provide `setExpandedNodes` callback to FileTreeNode
4. Wire onExpandAll/onCollapseAll to manipulate Set

**Effort:** 1-2 days (requires FileTree refactoring)

### Tooltip Display

**Feature:** Show tooltip on hover (vs aria-label only)

**Implementation:** Add tooltip component (e.g., Radix UI Tooltip)

**Effort:** 2-3 hours

### Additional Actions

**Potential Buttons:**
- Copy Path (copy tree root path to clipboard)
- Open in Editor (open folder in external editor)
- Sort (alphabetical, date modified, etc.)

**Effort:** 1-2 hours per button

---

## Footer

**Generated by:** coderef-docs agent (WO-EXPLORER-SIDEBAR-UX-001-DOCS-PHASE2)
**Timestamp:** 2026-01-17
**Modules Used:** architecture, integration, visual-design, accessibility, testing
**Complexity Score:** Low (94 lines, stateless component, simple callbacks)

**Recommended Next Steps:**
1. Implement unit tests for button rendering and callbacks
2. Add Expand/Collapse All functionality in Phase 3
3. Consider adding tooltips for better UX
4. Measure click interaction latency

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
