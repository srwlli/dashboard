---
agent: Claude Sonnet 4.5
date: "2026-01-12"
task: UPDATE
subject: Widget System
parent_project: coderef-dashboard
category: other
version: 1.0.0
related_files:
  - packages/dashboard/src/lib/WidgetRegistry.ts
status: APPROVED
---

# Widget System - Resource Sheet

**Category:** Architecture
**Type:** System Design
**Files:** `packages/dashboard/src/lib/WidgetRegistry.ts`, `coderef-dashboard.config.json`
**Created:** 2026-01-04
**Status:** Active

---

**Generated by:** Resource Sheet Generation Workflow
**Timestamp:** 2026-01-04
**Auto-fill Rate:** Manual (comprehensive analysis)

---

## Executive Summary

**Element:** Widget System
**Category:** Architecture
**Purpose:** Provides a modular architecture for extending the dashboard with new functionality (Explorers, Editors, Tools) without tight coupling to the core application shell.

**Key Concepts:**
- **Configuration-Driven:** Widgets are registered in `coderef-dashboard.config.json`.
- **Self-Contained:** Widgets manage their own state, layout, and persistence.
- **Client-First:** Designed primarily as React Client Components.
- **Persistence:** Relies on `localStorage` for state preservation across sessions.

---

## Architecture Overview

### 1. Registration & Discovery

**Registry:** `packages/dashboard/src/lib/WidgetRegistry.ts`
**Config:** `coderef-dashboard.config.json` (Root)

**Registration Flow:**
1.  **Define:** Add entry to `coderef-dashboard.config.json`.
    ```json
    {
      "id": "industrial-editor",
      "package": "@coderef-dashboard/widget-industrial-editor",
      "enabled": true,
      "settings": {}
    }
    ```
2.  **Load:** `WidgetRegistry` reads this config at runtime.
3.  **Render:** The host page (e.g., `app/page.tsx` or `app/editor/page.tsx`) imports and renders the widget component.
    *Note: Currently, dynamic import/rendering based *solely* on JSON is partial; manual import in the page wrapper is often required for the actual React component.*

### 2. File Structure

**Standard Location:** `packages/dashboard/src/widgets/<widget-kebab-name>/`

**Recommended Structure:**
```
packages/dashboard/src/widgets/industrial-editor/
├── index.tsx                  # Public API / Exports
├── IndustrialEditorWidget.tsx # Main Component (Smart Container)
├── components/                # Internal Presentational Components
│   ├── EditorSurface.tsx
│   └── Toolbar.tsx
└── __tests__/                 # Widget-specific tests
```

### 3. Widget Interface

**Type:** React Functional Component
**Props:** Flexible, but typically self-contained or accepts `settings`.

**Basic Signature:**
```typescript
export function IndustrialEditorWidget(): JSX.Element {
  // Logic
  return (
    <div className="h-full flex flex-col">
       {/* Content */}
    </div>
  );
}
```

**Common Patterns:**
- **Smart Container:** The top-level widget component handles logic, state, and persistence.
- **Dumb Children:** Sub-components render the UI based on props.

---

## Operational Mechanics

### 4. Inputs & Outputs

**Inputs:**
- **Configuration:** Passed via `settings` in `coderef-dashboard.config.json`.
- **URL Parameters:** Read via `useSearchParams()` (Next.js).
- **Global Context:** Can consume app-wide contexts (Theme, etc.) if wrapped.

**Outputs:**
- **State Changes:** Updates `localStorage`.
- **Events:** Currently no strict event bus; cross-component communication usually happens via URL state or shared `localStorage` events.

### 5. Layout & Chrome

**Philosophy:** "Bring Your Own Chrome" (mostly)
- **Container:** Widgets typically occupy 100% of the `flex-1` area provided by the host page.
- **Styling:** Should use the standard design tokens (`bg-ind-bg`, `border-ind-border`) to blend in.
- **Responsiveness:** Widget is responsible for its own responsive behavior (e.g., collapsing sidebars).

### 6. Persistence Strategy

**Primary Mechanism:** `localStorage`
**Scope:** Per-Widget or Per-Project isolation recommended.

**Best Practices:**
1.  **Key Naming:** `coderef-<widget>-<key>` (e.g., `coderef-editor-last-file`).
2.  **Graceful degradation:** Wrap `setItem` in try/catch for Quota limits or Private browsing.
3.  **Restoration:** `useEffect` on mount to restore state.
    ```typescript
    useEffect(() => {
      const lastFile = localStorage.getItem('coderef-editor-last-file');
      if (lastFile) setFilePath(lastFile);
    }, []);
    ```

---

## Implementation Guide: "Industrial File Editor"

To add your new editor widget:

**Step 1: Create Directory**
`packages/dashboard/src/widgets/industrial-editor/`

**Step 2: Create Main Component**
`IndustrialEditorWidget.tsx`:
```tsx
'use client';
import { useState, useEffect } from 'react';

export function IndustrialEditorWidget() {
  const [content, setContent] = useState('');
  // ... implementation
  return <div className="...">...</div>;
}
```

**Step 3: Create Export**
`index.tsx`:
```tsx
export { IndustrialEditorWidget } from './IndustrialEditorWidget';
```

**Step 4: Register (Optional for strictly local use, but good practice)**
Add to `coderef-dashboard.config.json`.

**Step 5: Mount**
Create a page wrapper (e.g., `app/editor/page.tsx`) that imports and renders `<IndustrialEditorWidget />`.

---

**Complexity Score:** Medium
**Modules Used:** Registry, React, LocalStorage
